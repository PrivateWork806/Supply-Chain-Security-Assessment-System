<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Supply Chain Security Assessment System</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #ecf0f3;
      height: 100vh;
      display: flex;
    }
    /* Sidebar */
    #sidebar {
      width: 240px;
      background: #2c3e50;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      display: none; /* hidden until login */
    }
    #sidebar h2 { font-size: 18px; margin-bottom: 15px; }
    #sidebar button {
      background: #34495e;
      border: none;
      padding: 10px;
      color: white;
      border-radius: 6px;
      text-align: left;
      cursor: pointer;
      transition: background 0.3s;
    }
    #sidebar button:hover { background: #1abc9c; }

    /* Main content */
    #main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: none; /* hidden until login */
    }
    h3 { margin-top: 0; }
    .card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 6px;
      overflow-x: auto;
    }
    .status-open { color: red; font-weight: bold; }
    .status-resolved { color: green; font-weight: bold; }
    .risk-high { color: red; font-weight: bold; }
    .risk-medium { color: orange; font-weight: bold; }
    .risk-low { color: green; font-weight: bold; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    table th {
      background: #3498db;
      color: white;
    }

    /* Login screen */
    #loginScreen {
      margin: auto;
      text-align: center;
    }
    #loginScreen input {
      display: block;
      margin: 10px auto;
      padding: 10px;
      width: 250px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #loginScreen button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #3498db;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    #loginScreen button:hover { background: #2980b9; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <h2>üîê SCSA Login</h2>
    <input type="email" id="email" placeholder="Email" value="admin.scsa@gmail.com">
    <input type="password" id="password" placeholder="Password" value="password">
    <button onclick="doLogin()">Login</button>
  </div>

  <!-- Sidebar -->
  <div id="sidebar">
    <h2>üìä SCSA System</h2>
    <button onclick="viewSuppliers()">üìã View Suppliers</button>
    <button onclick="addSupplier()">‚ûï Add Supplier</button>
    <button onclick="removeSupplier()">‚ùå Remove Supplier</button>
    <button onclick="viewAssessments()">üìä View Assessments</button>
    <button onclick="viewRiskDistribution()">üìà Risk Distribution</button>
    <button onclick="viewIncidents()">‚ö†Ô∏è View Incidents</button>
    <button onclick="addIncident()">‚ûï Log Incident</button>
    <button onclick="viewAudit()">üïë Audit Log</button>
    <button onclick="doLogout()">üö™ Logout</button>
  </div>

  <!-- Main -->
  <div id="main">
    <div class="card">
      <h3>Welcome</h3>
      <p id="welcome">Please log in to continue...</p>
    </div>
    <div class="card">
      <h3>Output</h3>
      <div id="output">Nothing yet.</div>
    </div>
  </div>

  <script>
    // Sample Data
    let suppliers = [
      {id:1, name:"Alpha Logistics", industry:"Transport", contact_email:"alpha.logistics@gmail.com", phone:"+254700111111", contact_person:"John Doe", risk_tier:"Medium"},
      {id:2, name:"Global Foods Ltd", industry:"Retail", contact_email:"globalfoods@gmail.com", phone:"+254722222222", contact_person:"Mary Ann", risk_tier:"Low"},
      {id:3, name:"TechSource IT", industry:"Technology", contact_email:"techsourceit@gmail.com", phone:"+254733333333", contact_person:"Kevin Smith", risk_tier:"High"},
      {id:4, name:"PharmaHealth Supplies", industry:"Healthcare", contact_email:"pharmahealthsupplies@gmail.com", phone:"+254744444444", contact_person:"Dr. Alice", risk_tier:"Medium"}
    ];
    let assessments = [
      {supplier_id:1, risk_score:65, by:"assessor.scsa@gmail.com", date:"2025-09-01"},
      {supplier_id:3, risk_score:82, by:"assessor.scsa@gmail.com", date:"2025-09-10"},
      {supplier_id:4, risk_score:48, by:"assessor.scsa@gmail.com", date:"2025-09-20"}
    ];
    let incidents = [
      {id:1, supplier_id:1, description:"Truck breakdown delayed delivery", severity:"Medium", status:"Resolved"},
      {id:2, supplier_id:3, description:"Cybersecurity breach in supplier system", severity:"High", status:"Open"},
      {id:3, supplier_id:2, description:"Late supply of goods during holiday", severity:"Low", status:"Resolved"}
    ];
    let audit = [];

    const users = [
      {email:"admin.scsa@gmail.com", password:"password", role:"Admin"},
      {email:"assessor.scsa@gmail.com", password:"password", role:"Assessor"},
      {email:"auditor.scsa@gmail.com", password:"password", role:"Auditor"}
    ];
    let currentUser = null;

    function logAction(action, details="") {
      audit.unshift({user: currentUser.email, action, time:new Date().toLocaleTimeString(), details});
    }

    function doLogin() {
      const email = document.getElementById("email").value;
      const pw = document.getElementById("password").value;
      const u = users.find(x=>x.email===email && x.password===pw);
      if(u){
        currentUser=u;
        logAction("LOGIN","User logged in");
        document.getElementById("loginScreen").style.display="none";
        document.getElementById("sidebar").style.display="flex";
        document.getElementById("main").style.display="block";
        document.getElementById("welcome").innerText="‚úÖ Logged in as "+u.role;
      } else {
        alert("Invalid login. Try admin.scsa@gmail.com / password");
      }
    }

    function doLogout(){
      logAction("LOGOUT","User logged out");
      currentUser=null;
      document.getElementById("loginScreen").style.display="block";
      document.getElementById("sidebar").style.display="none";
      document.getElementById("main").style.display="none";
    }

    function addSupplier() {
      const name=prompt("Supplier name");
      const ind=prompt("Industry");
      const mail=prompt("Email");
      const phone=prompt("Phone");
      const contact=prompt("Contact Person");
      const id = suppliers.length+1;
      suppliers.push({id,name,industry:ind,contact_email:mail,phone,contact_person:contact,risk_tier:"Medium"});
      logAction("CREATE_SUPPLIER",name);
      show("Supplier added: "+name);
    }

    function removeSupplier(){
      const sid=prompt("Enter Supplier ID to remove");
      const index=suppliers.findIndex(s=>s.id==sid);
      if(index>=0){
        const name=suppliers[index].name;
        suppliers.splice(index,1);
        logAction("REMOVE_SUPPLIER",name);
        show("Supplier removed: "+name);
      } else {
        alert("Supplier not found");
      }
    }

    function viewSuppliers() {
      let html = "<h4>Suppliers</h4><table><tr><th>ID</th><th>Name</th><th>Industry</th><th>Email</th><th>Phone</th><th>Contact</th><th>Tier</th></tr>";
      suppliers.forEach(s=>{
        html += `<tr>
          <td>${s.id}</td><td>${s.name}</td><td>${s.industry}</td>
          <td>${s.contact_email}</td><td>${s.phone}</td><td>${s.contact_person}</td>
          <td><span class="risk-${s.risk_tier.toLowerCase()}">${s.risk_tier}</span></td>
        </tr>`;
      });
      html += "</table>";
      show(html);
    }

    function viewAssessments(){
      let html="<h4>Assessments</h4><table><tr><th>Supplier</th><th>Risk Score</th><th>Assessor</th><th>Date</th></tr>";
      let labels=[], scores=[];
      assessments.forEach(a=>{
        const sup = suppliers.find(s=>s.id==a.supplier_id);
        let riskClass=a.risk_score>70?"high":a.risk_score>40?"medium":"low";
        html += `<tr><td>${sup? sup.name:"Unknown"}</td><td><span class="risk-${riskClass}">${a.risk_score}</span></td><td>${a.by}</td><td>${a.date}</td></tr>`;
        labels.push(sup? sup.name:"Unknown");
        scores.push(a.risk_score);
      });
      html+="</table><canvas id='assessChart'></canvas>";
      show(html);
      new Chart(document.getElementById("assessChart"), {
        type:"bar",
        data:{labels:labels,datasets:[{label:"Risk Score",data:scores,backgroundColor:scores.map(s=>s>70?"red":s>40?"orange":"green")}]},
        options:{responsive:true,scales:{y:{beginAtZero:true,max:100}}}
      });
    }

    function viewRiskDistribution(){
      let counts={High:0,Medium:0,Low:0};
      suppliers.forEach(s=>{counts[s.risk_tier]++;});
      let html="<h4>Risk Distribution</h4><canvas id='pieChart'></canvas>";
      show(html);
      new Chart(document.getElementById("pieChart"), {
        type:"pie",
        data:{labels:["High","Medium","Low"],datasets:[{data:[counts.High,counts.Medium,counts.Low],backgroundColor:["red","orange","green"]}]}
      });
    }

    function addIncident(){
      const sid=prompt("Supplier ID");
      const desc=prompt("Description");
      const sev=prompt("Severity (High/Medium/Low)");
      const supplier = suppliers.find(s=>s.id==sid);
      incidents.push({id:incidents.length+1,supplier_id:sid,description:desc,severity:sev,status:"Open"});
      logAction("CREATE_INCIDENT",desc);
      show(`Incident logged for <b>${supplier? supplier.name:"Supplier "+sid}</b>: ${desc} (Severity: ${sev})`);
    }

    function viewIncidents(){
      let html="<h4>Incidents</h4><table><tr><th>Supplier</th><th>Description</th><th>Severity</th><th>Status</th></tr>";
      incidents.forEach(i=>{
        const sup = suppliers.find(s=>s.id==i.supplier_id);
        html += `<tr><td>${sup? sup.name:"Unknown"}</td><td>${i.description}</td>
          <td class="risk-${i.severity.toLowerCase()}">${i.severity}</td>
          <td class="status-${i.status.toLowerCase()}">${i.status}</td></tr>`;
      });
      html+="</table>";
      show(html);
    }

    function viewAudit(){
      let html="<h4>Audit Log</h4><pre>";
      audit.forEach(a=>{
        html += `[${a.time}] ${a.user} ‚Üí ${a.action} (${a.details})\n`;
      });
      html+="</pre>";
      show(html);
    }

    function show(html){ document.getElementById("output").innerHTML=html; }
  </script>
</body>
</html>
